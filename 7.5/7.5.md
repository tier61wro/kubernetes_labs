https://go.skillbox.ru/education/course/devops-kubernetes/55a6a1ce-36b2-4525-92d6-d558067468f4/homework

# 7.5 Практическая работа
## Цель домашнего задания
В этом модуле вы познакомились с Helm и другими инструментами, помогающими деплоить приложения в кластер. 

Вам предстоит попрактиковаться в применении шаблонизаторов и кастомизаторов и на деле увидеть преимущества их использования по сравнению с обычными YAML-файлами.



### Что входит в задание
Внести изменения в Helm-шаблоны.
Сгенерировать шаблоны для разных окружений с помощью Kustomize.


## Задание 1. Внесение изменений в Helm-шаблоны    
### Что нужно сделать

Внесите изменения в Helm-шаблоны:

Добавьте возможность создавать манифест объекта секрет только при значении переменной docker.secret.create из файла values.yaml равном true.
Добавьте возможность автоматически подставлять имя хоста в параметр host объекта ингресс в соответствии с заданным окружением.
Для этого:

Установите Helm по инструкции с официального сайта.
Перейдите в папку module-7/Homework/task-1/ и запустите команду:
`helm template .`
Helm отрендерил манифесты секрета и ингресса. Так как докер-секрет нужно создавать далеко не всегда, дополните шаблон secret.yaml в соответствии с заданием 1 — дополните шаблон файла secret.yaml так, чтобы секрет secret-dockercfg создавался только при значении переменной docker.secret.create из файла values.yaml равном true.
Hint: для такого рода задач удобно использовать условие if

Обратите внимание, что на месте имени хоста в отрендеренном объекте ингресса стоит none. Как правило, для разных окружений должны использоваться разные имена хостов. Поэтому, в соответствии с заданием 2, измените шаблон файла ingress.yaml так, чтобы при задании переменной global.env значениями test или prod в поле host ингресса подставлялись соответственно значения из host.test или host.prod из файла values.yaml.
Например:
```
helm template . --set global.env=test //host: test.billing.com
helm template . --set global.env=prod //host: production.billing.com
```
```
Hint 1: такие задачи удобно решать с использованием оператора pluck
Hint 2: пример похожей задачи
```

### Что оценивается

Соответствие отредактированных шаблонов ingress.yaml и secret.yaml поставленным задачам.



### Как отправить задание на проверку

Пришлите YAML-файлы обновлённых шаблонов ingress.yaml и secret.yaml через форму ниже.



## Задание 2. Генерация шаблонов для разных окружений с помощью Kustomize
### Что нужно сделать

Добавьте окружения dev и prod, для которых укажите следующие параметры: 

namespace: dev и prod
namePrefix: dev- и prod-
образ контейнера nginx:
для dev — nginx:latest
для prod — nginx:1.12
Для этого:

Убедитесь, что kubectl содержит kustomize. Для этого запустите команду:
`kubectl kustomize --help`
В папке module-7/Homework/task-2/base находятся базовые манифесты, которые мы будем изменять с помощью kustomize. Команда: 
`kubectl kustomize .`
    Команда отрендерит базовые манифесты в неизменном виде.

Создайте директорию overlays в папке module-7/Homework/task-2/и в ней — ещё две директории dev и prod. В каждую из директорий положите файл kustomization.yaml со следующими трансформациями:
namespace 
namePrefix
images
    `Hint: описание всех этих параметров вы можете найти по ссылке`
Проверьте, что манифесты создаются с нужными параметрами, командами из папки module-7/Homework/task-2/:
```
kubectl kustomize overlays/dev
kubectl kustomize overlays/prod 
```

### Что оценивается

Корректность файлов kustomization.yaml для окружений dev и prod.